记录神经现场～～～～
## 神经初期（所谓的预编译）
![ujs1](~@imgs/unjs1.png)

**读到1我有了一个疑问，所以这是变量提升吗？那么变量提升是在编译阶段吗？**

- 于是我们开始查询资料，看看有没有详细的说明。[JS 编译器，解释引擎 | 前端日志 (mengsixing.github.io)](https://mengsixing.github.io/blog/js-principle.html#%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B) 这文章讲：生成机器码后才开始预编译和变量提升。咦这跟书对不上。这个很离谱。

- [JavaScript到底是解释型语言还是编译型语言? - SegmentFault 思否](https://segmentfault.com/a/1190000013126460) ，读完：分词和AST不是编译器的工作吗，当然说是引擎也没啥问题，毕竟调度都是引擎的工作。这个和书上讲的类似：在AST->生成机器码之间的某个过程，发生了预编译和变量提升。翻译的文章就权威了？？？

我们查了很多文章，都只是说了：_**在真正执行代码****前****，会有预编译阶段，这个阶段收集变量声明。**_
_**那么这个阶段对应到v8哪个步骤呢？是这个中间过程，所谓的“预编译”？？**_

于是我们再查资料，我们开始探索V8。




## 神经中期（确认阶段）

于是我们开始新的探索；

- 阶段1：搜索预解析，pre-parser莫名搜到了惰性解析，莫名学习了一波，甚至直接看的英文文章
- 阶段2：从某个文章开始看图解V8，**图解V8说：解析器解析过程会生成AST和作用域，确认作用域阶段会发生变量提升。我开始确认是生成AST阶段。**
- 阶段3：然后搜索生成AST和作用域的先后？然后知道了预解析和全解析，预解析有些文章说不生成AST，有些说生成**，但是他们都生成作用域，好耶！！！！**
- 阶段4：[https://segmentfault.com/q/1010000038371425?sort=newest](https://segmentfault.com/q/1010000038371425?sort=newest) ？图解V8说的不对吗？？
   - 结合：[教女朋友学前端之深入理解JS引擎 | 童欧巴博客 (hungryturbo.com)](https://hungryturbo.com/pages/fa7f62/#%E8%A7%A3%E6%9E%90%E5%99%A8-parser) 
   - 花钱买了！[https://xiaozhuanlan.com/topic/1946507283](https://xiaozhuanlan.com/topic/1946507283) 
   - 抓狂😫：是生成了执行上下文，还是作用域？？ 

**终于我的得出了结论，全文重点⬇️**：

1. **在懒惰解析生成AST的过程，会发生两种解析：预解析与全量解析。**
1. **遇到不立即执行的函数，就进行预解析，从而生成 AST，会产生不带有变量引用和声明的 scopes 信息（这项工作由 Pre-Parser 预解析器完成）**
1. **遇到立即执行的函数，或者被调用的函数，进行全量解析，生成AST和作用域信息（也可以理解为是执行上下文的创建阶段）**

**至此说服了自己，变量提升和作用域确定发生在生成AST阶段**。见补图小小论证。




## 神经晚期（回顾总结阶段）

开始回归书本，虽然这段话没指明是那个阶段，但是我们知道是生成机器码前的某个阶段。
38页也很好的说明了，**编译阶段中的一部分工作就是找到所有变量声明，并用合适的作用域将他们关联起来。**
我们迷惑的点在于：**是生成AST阶段呢，还是在执行机器码之前的所谓“预编译”？**这本书写时，应该没有V8，应该也没过度追究细节。我们自己知道因为时间和发展原因，大概有2种理解就好。⬇️⬇️

至此，我的结论是：**变量提升发生在生成AST阶段，这个阶段确定了作用域信息**。如果以后的面试官说：在AST->执行代码之间的预编译阶段，我只能勉强的同意了。




## 神经衰弱（个人总结）

在查资料的过程中，一直在论证学习。很多文章写的不一定是对的，他只是抄的。如果我直接看V8文档就不用怀疑真假了吧.......
这个过程和记录这个过程花了很长时间(大概2天)，以后尽量避免这种牛角尖。


**终于我说服了部分自己！！！！**

**_另外：中文博客就是互相抄。_**

**_需要补充学习：执行上下文。_**

## 补充图解V8
![v83](~@imgs/v83.png)
![v84](~@imgs/v84.jpeg)
